### ch07 审阅报告（已完成）

#### 概览
- 章节：ch07（基于树的集成模型：决策树、随机森林、梯度提升）
- 小节清单与定位：
  - ch07/7_1_business_challenge.qmd
  - ch07/7_2_decision_tree.qmd
  - ch07/7_3_ensemble_philosophy.qmd
  - ch07/7_4_random_forest.qmd
  - ch07/7_5_gradient_boosting.qmd
  - ch07/7_6_xai_for_trees.qmd
  - ch07/7_7_vibe_coding_practice.qmd
  - ch07/7_8_exercises.qmd
- 总体评估：
  - FP：3/4（信息熵/基尼与 Bagging/Boosting 的第一性阐释扎实；建议补充 sklearn 近年 API 与能力边界）
  - VC：4/4（交互资产丰富、实践闭环到位）
  - BP：3/4（建议统一采用现代 API：RandomForest 与 HistGradientBoosting 的能力、评估与解释手段）
  - 一句话结论：叙事完整、案例充实；需补工程化与评估一致性（OOB、PR 曲线、早停、原生类别特征、单调约束、PDP/ICE 与置换重要性）。

#### 证据与问题（按小节）
- 7_1_business_challenge（`ch07/7_1_business_challenge.qmd`）
  - 关键论断：非线性与交互使线性模型受限，树模型能“分而治之”。
  - 风险与边界：回归目标分布重尾时，建议在后续引入稳健/分位数损失（HGBR 的 `loss='quantile'`、`absolute_error`）。

- 7_2_decision_tree（`ch07/7_2_decision_tree.qmd`）
  - 证据：
    - 分类不纯度：Gini/Entropy/Log Loss；回归：`squared_error/poisson/absolute_error`。
    - `export_text/plot_tree/decision_path` 可视化与调试；支持 `sample_weight`。
    - 支持缺失值预测路径（文档说明）与单调约束（1.4+）。
  - 风险与边界：
    - 过拟合与复杂度控制：`max_depth/min_samples_leaf/min_impurity_decrease/ccp_alpha`（建议在文中示例化）。

- 7_3_ensemble_philosophy（`ch07/7_3_ensemble_philosophy.qmd`）
  - 证据：偏差-方差权衡图（资产已具备）。
  - 建议：在文字中显式提示“Bagging 降方差、Boosting 降偏差”的验证性实验（学习/验证曲线）。

- 7_4_random_forest（`ch07/7_4_random_forest.qmd`）
  - 证据：
    - “两个随机”：Bootstrap（行）、特征子采样（列，分类默认 `max_features='sqrt'`）。
    - OOB 评估：`oob_score=True`；注意多输出多分类不支持 OOB（官方限制）。
    - 支持 `class_weight`、`estimators_samples_`、缺失值（1.4+ 对特定 criterion），单调约束（1.4+）。
  - 风险与边界：
    - 重要性以 impurity 为基础存在偏倚，推荐补充 `permutation_importance` 的报告。
    - 概率校准偏差：RF 往往“概率不极端”，如需阈值与成本决策，建议结合校准与 PR 曲线。

- 7_5_gradient_boosting（`ch07/7_5_gradient_boosting.qmd`）
  - 证据：
    - 传统 GBDT vs HistGradientBoosting（HGB）：HGB 原生直方图加速、缺失值原生支持、`max_iter`、早停（`early_stopping`/`X_val` 参数）、`categorical_features='from_dtype'`、`monotonic_cst`、`interaction_cst`、`partial_dependence` 的 recursion 加速。
    - 业界框架：XGBoost（泰勒二阶、内置正则化），LightGBM（直方图 + 叶子优先、原生类别）。
  - 风险与边界：
    - 大数据/类别特征：在 sklearn 侧优先使用 HGB 原生类别；跨框架对比时需注明编码策略一致性（One-Hot vs 原生类别）。
    - 评估一致性：引入 PR-AUC/平均精度、早停与验证集，避免仅看 Accuracy/ROC。

- 7_6_xai_for_trees（`ch07/7_6_xai_for_trees.qmd`）
  - 证据：
    - PDP/ICE：`PartialDependenceDisplay.from_estimator`（支持 cICE、recursion、categorical）；
    - 置换重要性：`permutation_importance(max_samples=...)` 可控成本；
    - SHAP：TreeExplainer 适配树模型（教材示例已具备）。
  - 风险与边界：
    - PDP 对数值列要求浮点类型；多类 PDP 需指定 `target`。
    - 对高维高相关场景，PDP/SHAP 的“因果解释”风险需加注释，定位为“模型解释”。

- 7_7_vibe_coding_practice（`ch07/7_7_vibe_coding_practice.qmd`）
  - 建议强化：
    - 使用 `StratifiedKFold`、多指标 `scoring={'roc_auc','average_precision','recall'}`；
    - 对 LightGBM：明确 `categorical_feature` 设置，早停 `early_stopping_rounds`，与 sklearn HGB 做对照实验；
    - 报告 `classification_report` 与 PR 曲线、阈值扫描/成本曲线。

- 7_8_exercises（`ch07/7_8_exercises.qmd`）
  - 建议新增：
    - “OOB vs 验证集”一致性实验；
    - “原生类别 vs One-Hot”的效果对比；
    - “单调约束/交互约束”对稳定性与业务先验对齐的练习。

#### 修订建议与优先级
- P0
  - 在随机森林示例中加入 OOB 分数（并注明多输出多分类限制）；重要性报告增加 `permutation_importance`。
  - 在梯度提升示例中统一加入早停与验证集（HGB 的 `early_stopping` 或 `X_val/y_val`）；评估补充 PR-AUC/平均精度。
  - 若示例需概率作业务阈值，请注明 RF 概率偏“温和”，必要时做校准后再阈值调优。

- P1
  - 在 HGB 示例中展示 `categorical_features='from_dtype'`、`monotonic_cst`、`interaction_cst` 的最小用法与注意事项。
  - 在 XAI 小节补充 PDP/ICE（多类 `target` 参数、recursion 加速）与置换重要性（`max_samples`）代码片段与图表。
  - 在实践页引入 `StratifiedKFold` 与多指标 `scoring`，并提供阈值-成本曲线或 `TunedThresholdClassifierCV` 的参考链接。

- P2
  - 统一交互资产为预渲染 HTML + iframe，标注“正类定义/指标含义/单位”。
  - 在“Bagging vs Boosting”处加入一张速查表（目标、训练方式、基学习器、对偏差/方差影响、典型用例）。

#### 资源与可复现性
- 建议新增最小脚本（`book/code/ch07/`）：
  1) `rf_oob_vs_cv.py`（演示 OOB 与验证集一致性、并输出置换重要性与 PR 曲线）
  2) `hgb_categorical_monotonic.py`（HGB 原生类别 + 单调/交互约束 + 早停）
  3) `pdp_ice_demo.py`（PartialDependenceDisplay 的 PDP/ICE/cICE 与 recursion）
  4) `shap_tree_demo.py`（树模型 SHAP 总结图与依赖图）
- 资产：现有 `book/assets/ch07/*.html` 可复用；建议补充 PDP/ICE 与 PR 曲线的预渲染 HTML。

#### 术语与引用（访问日期 2025-08）
- 决策树：`DecisionTreeClassifier/Regressor`、`export_text/plot_tree`、不纯度与分裂准则、`sample_weight`、单调约束（1.4+）。
- 随机森林：`RandomForestClassifier/Regressor`、`oob_score`、`class_weight`、`max_features` 默认、缺失值与单调约束支持、`estimators_samples_`。
- 直方图梯度提升（HGB）：`HistGradientBoostingClassifier/Regressor`、`early_stopping`/`X_val`、`categorical_features='from_dtype'`、`monotonic_cst`、`interaction_cst`、`partial_dependence` recursion。
- 解释与评估：`permutation_importance`、`PartialDependenceDisplay`（PDP/ICE/cICE、categorical、target）、`precision_recall_curve/average_precision_score`、`classification_report`。
- 说明：XGBoost/LightGBM 为外部框架，性能特性与类别特征支持以其官方文档为准；教材对比应明确实验控制（编码、损失、早停）。

（以上均基于 scikit-learn 1.7 系列官方文档与发布说明）

#### 状态与动作
- 审核状态：已完成
- 负责人 / 截止：AI 助理 / 本次迭代
- 变更记录：新增 FP/VC/BP 评分、证据/边界与 P0–P2 修订项；补全资源与“术语与引用”。
