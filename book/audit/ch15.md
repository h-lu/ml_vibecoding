### ch15 审阅报告（已完成）

#### 概览
- 章节：ch15（AI 的“世界模型”：构建可信的 RAG 系统）
- 小节清单与定位：
  - ch15/15_1_business_challenge.qmd
  - ch15/15_2_first_principle.qmd
  - ch15/15_3_rag_foundation.qmd
  - ch15/15_4_chunking.qmd
  - ch15/15_5_vibe_coding_practice.qmd
  - ch15/15_6_exercises.qmd
- 总体评估：
  - FP：3/4（“封闭大脑→开卷考试”的动机清晰；分块/嵌入/检索/增强链条完整；可补评估与安全边界）
  - VC：4/4（实践分三阶段+元数据过滤与安全反思，贴合架构师思维）
  - BP：3/4（建议补 2024–2025 RAG 工程化要点：混合检索/重排、评估与观测、合规与红队、向量库对比与部署）
  - 一句话结论：本章完成从原型到生产思路的跃迁，补充工程与治理细节即可作为生产级 RAG 参考。

#### 证据与问题（按小节）
- 15_1 商业挑战（`ch15/15_1_business_challenge.qmd`）
  - 认可点：以金融合规事故引出“幻觉”与不可控性，对 FP 与系统目标定位准确。
  - 建议（BP）：明确对“可追溯/引用/新鲜度”三指标的业务约束，并提出可验证验收标准（cite率、引用命中率、时间过滤命中率）。

- 15_2 第一性原理（`ch15/15_2_first_principle.qmd`）
  - 认可点：“开卷考试”流程图与角色转换清晰。
  - 建议：
    - 明确上下文窗口限制与成本函数对 Top-K 的影响；
    - 强化“仅基于上下文作答/未知即我不知道”的提示约束；
    - 补充引用返回（source_documents）与引用格式规范。

- 15_3 嵌入与向量库（`ch15/15_3_rag_foundation.qmd`）
  - 认可点：BGE-M3、OpenAI t-e-3、CLIP 与 bge-vl 的场景区分合理；Chroma/Qdrant/Weaviate/Pinecone 的选型维度明确。
  - P1（BP）：
    - 嵌入：建议默认 L2 归一化+内积（等价余弦），批量与缓存；多语言与行业语料适配；
    - 向量库：索引（HNSW/IVF/Flat）与参数提示；元数据过滤性能注意；
    - 混合检索与重排：BM25+向量混检、Cross-Encoder 重排以提升精度；
    - 评估：召回/命中率@K、mAP、基于引用的答案正确率；
    - 观测：记录查询、命中、延迟、成本，A/B 对比；
    - 合规：数据去标识、访问控制、脱敏与审计日志。

- 15_4 分块（`ch15/15_4_chunking.qmd`）
  - 认可点：固定/递归/结构感知切分的优劣与适用清晰。
  - 建议：提供“网格搜索 chunk_size×overlap×Top-K”的实验建议；富文档解析（unstructured、MarkItDown）与表格/代码处理要点；跨块拼接（context window 智能拼接）。

- 15_5 实践（`ch15/15_5_vibe_coding_practice.qmd`）
  - 认可点：全开源栈（LangChain + Chroma + BGE + Qwen3-0.6B），含元数据过滤挑战与分块对比，贴合 VC。
  - P0（BP 纠偏/补强）：
    - 生成约束：严格加入“仅基于上下文作答；无信息则答我不知道；返回引用与元数据”；
    - 嵌入与向量库：开启持久化与缓存、归一化策略；
    - 检索链：混合检索/重排可选路径；
    - 环境：固定随机种子；
  - P1：
    - 观测：打印/记录 Top-K 命中内容、token 成本、延迟；
    - 安全：清洗不可见字符、提示注入防护（系统提示前置规则）、红队样例；
    - 评估：小型问答集与自动化线下评估脚本。

- 15_6 练习（`ch15/15_6_exercises.qmd`）
  - 认可点：RAG vs Fine-tuning 对比与项目化架构设计题切实。
  - 建议：在对比表中加入“运维（更新/回滚）”“合规（可追溯/数据边界）”“成本（嵌入/存储/推理）”维度；实践题要求标注评估与观测方案。

#### 修订建议与优先级
- P0（阻断/高风险）
  - 在 15.5 的链路中加入强约束 Prompt 模板（仅依据上下文/未知即我不知道/返回来源与元数据），并默认打印 source_documents；
  - 启用嵌入缓存与 Chroma 持久化，固定随机种子，记录 Top-K 命中。

- P1（重要提升）
  - 混合检索与重排：BM25+向量、Cross-Encoder（如 `cross-encoder/ms-marco-MiniLM-L-6-v2`）；
  - 评估与观测：线下问答集、hit@k/引用正确率/延迟与成本面板；
  - 安全与合规：数据清洗、访问控制、审计日志、红队清单；
  - 部署与运维：向量库与嵌入版本/回滚策略。

- P2（打磨/一致性）
  - 统一术语：混合检索/重排/Top-K/Chunk/元数据过滤/引用；
  - 可视化：RAG 质量对比表与“chunk×Top-K 网格搜索”结果示例。

#### 资源与可复现性
- 依赖建议：`langchain`、`langchain-community`、`langchain-huggingface`、`chromadb`、`sentence-transformers`、`torch`、`accelerate`；
- 资产：`assets/ch15/` 目录为空缺但章节无 iframe 需求，非阻断；
- 运行：`.env`/API Key 隔离（如更换闭源嵌入）、嵌入缓存与持久化、随机种子；
- 输出：答案与来源并列打印，保存检索日志用于回放与审核。

#### 术语与引用（访问日期 2025-08）
- LangChain/LangGraph 文档：
  - https://python.langchain.com
  - https://langchain-ai.github.io/langgraph/
- 向量库：
  - ChromaDB：https://docs.trychroma.com
  - Qdrant：https://qdrant.tech/documentation/
  - Weaviate：https://weaviate.io/developers
  - Pinecone：https://docs.pinecone.io
- 嵌入与重排：
  - BGE/BGE-M3：https://huggingface.co/BAAI/bge-m3
  - Cross-Encoder（MS MARCO）：https://www.sbert.net
- 安全与合规：
  - OWASP Top 10 for LLM Applications（数据投毒/提示注入等）

#### 状态与动作
- 审核状态：已完成（6/6）
- 后续动作：
  - P0：在 15.5 代码提示中加入强约束模板与来源返回、缓存与持久化；
  - P1：补混合检索/重排、评估与观测、安全与运维建议细化；
  - P2：统一术语与补可视化对比。