### ch06 审阅报告（已完成）

#### 概览
- 章节：ch06（第六章：分类问题——逻辑回归与支持向量机）
- 小节清单与定位：
  - ch06/6_1_business_challenge.qmd
  - ch06/6_2_probability_vs_geometry.qmd
  - ch06/6_3_kernel_trick.qmd
  - ch06/6_4_xai.qmd
  - ch06/6_5_vibe_coding_practice.qmd
  - ch06/6_6_exercises.qmd
- 总体评估：
  - FP：3/4（“概率 vs 几何”的第一性对照清晰；建议补充更多“阈值与成本”边界和概率校准的可验证示例）
  - VC：4/4（交互式可视化与对话式实践完整，读者能“玩起来”）
  - BP：3/4（建议统一 Pipeline 与标准化、概率校准与阈值调优、PR 曲线与不平衡评估）
  - 一句话结论：本章将逻辑回归与 SVM 的核心思想落得扎实，建议补齐“工程规范与校准/阈值”的最佳实践闭环。

#### 证据与问题（按小节）
- 6_1_business_challenge（`ch06/6_1_business_challenge.qmd`）
  - 关键论断：分类=在特征空间寻找决策边界；展示 p=0.5 等高线与边界。
  - 证据与链接：
    - 决策边界可视化：DecisionBoundaryDisplay.from_estimator（见“术语与引用”）。
  - 风险与边界：
    - p=0.5 仅是默认阈值；业务场景常需按成本曲线调阈（见 TunedThresholdClassifierCV）。
    - 不平衡数据下 Accuracy 误导，建议同时展示 PR 曲线/平均精度（AP）。

- 6_2_probability_vs_geometry（`ch06/6_2_probability_vs_geometry.qmd`）
  - 关键论断：逻辑回归（对数几率-概率）vs SVM（最大间隔-几何）。
  - 证据与链接：
    - LogisticRegression 求解器/惩罚项/多分类与概率性质；SVC 的 C/gamma、decision_function 与 predict_proba（Platt scaling）。
  - 风险与边界：
    - LR 概率通常较易校准；SVC `probability=True` 会触发代价较高的内部 CV，且仍可能需二次校准（CalibratedClassifierCV）。
    - SVM 对尺度敏感，需配合 StandardScaler 且置于 Pipeline 内以防泄露。

- 6_3_kernel_trick（`ch06/6_3_kernel_trick.qmd`）
  - 关键论断：核技巧=在高维空间的隐式点积；RBF 核与 C/gamma 权衡拟合度与光滑性。
  - 证据与链接：
    - RBF 核定义，gamma 默认 `'scale'`；也可用 RBFSampler 做近似以降本。
  - 风险与边界：
    - 未标准化会改变距离度量，导致 gamma/C 选择失真。
    - 仅调单一超参易过拟合，建议网格/随机搜索并结合验证曲线。

- 6_4_xai（`ch06/6_4_xai.qmd`）
  - 关键论断：对分类模型进行全局/个体解释，识别潜在偏见。
  - 证据与链接：
    - SHAP 总结/力图；补充：线性模型可先用系数与 permutation_importance，树/核方法慎用基于梯度的解释。
  - 风险与边界：
    - SVM 的概率非天然校准，偏见分析前应先做校准以免误读概率。
    - 受保护属性（性别/种族）相关性应显性评估并在教材中给出警示语。

- 6_5_vibe_coding_practice（`ch06/6_5_vibe_coding_practice.qmd`）
  - 关键论断：以不平衡流失预测为例，比较错误类型成本，演示 SMOTE 与 class_weight。
  - 证据与链接：
    - imblearn 管线+SMOTE 仅用于训练分折，防止泄露；LogisticRegression/SVC 支持 class_weight 与 sample_weight。
  - 风险与边界：
    - 必须将 SMOTE 放在拆分之后且仅对训练集；建议使用 imblearn.pipeline.Pipeline 固化流程。
    - 评估建议使用 PR 曲线、Recall/Precision/F1（针对正类）与平均精度（AP），并结合阈值调优。

- 6_6_exercises（`ch06/6_6_exercises.qmd`）
  - 练习建议增强：
    - 加入“校准曲线”对比（LR vs SVC 原生 vs SVC+CalibratedClassifierCV），并比较 Brier 分数。
    - 加入“阈值-业务成本”情境题（用 TunedThresholdClassifierCV 自动寻优）。
    - 加入“标准化缺失前后”的实验对照，直观展示 SVM 性能差异。

#### 修订建议与优先级
- P0（立即修复/高风险）
  - 在所有 SVM 示例中，统一使用 `Pipeline(StandardScaler, SVC/LinearSVC)`，严禁手动先 fit 再 transform 的泄露写法。
  - 在不平衡实践中，SMOTE 必须置于训练集分折之内（imblearn.pipeline），并与交叉验证兼容。
  - 对使用 `SVC(probability=True)` 的示例，补充性能/时间成本提示；如需可靠概率，请给出 `CalibratedClassifierCV` 替代方案。

- P1（重要提升/一致性）
  - 增补“阈值调优”示例：使用 `TunedThresholdClassifierCV`，展示基于 Recall/Precision/Fβ 或成本函数的阈值选择。
  - 在评估小节将 ROC-AUC 与 PR-AUC 并列，并强调不平衡场景首选 PR-AUC/Recall@K。
  - 为核技巧小节加入“验证曲线/学习曲线”图，展示 C/gamma 变化对过拟合/欠拟合的影响。
  - 在 XAI 小节加入“校准曲线（CalibrationDisplay）+ Brier 分数”示例，先校准再解释。

- P2（打磨/风格）
  - 在讲述“概率 vs 几何”处，补一张对照表：输出、可解释性、对尺度敏感性、是否需校准、典型应用场景。
  - 在作业中加入“业务成本矩阵”模板（例如 FN: 100×FP 成本），引导阈值落地。
  - 为现有交互图统一字号/色板与说明文字，标注“正类定义”。

#### 资源与可复现性
- 代码/数据/环境：
  - 建议在 `book/code/ch06/` 提供最小可运行脚本：
    1) `pipeline_svc_standardize.py`（Pipeline+StandardScaler+SVC）
    2) `calibration_compare_lr_svc.py`（LR vs SVC 概率校准与 Brier/校准曲线）
    3) `threshold_tuning_pr.py`（TunedThresholdClassifierCV 基于 PR 指标/成本）
    4) `smote_pipeline_demo.py`（imblearn 管线放置 SMOTE，演示泄露对比）
  - 交互可视化统一预渲染为 HTML 存入 `book/assets/ch06/`，在 `.qmd` 以 iframe 引用（当前已存在多项资产，建议补充校准曲线/验证曲线 HTML）。

#### 术语与引用（访问日期 2025-08）
- Pipeline 与标准化：`make_pipeline(StandardScaler(), SVC())`
- SVC 概率与 Platt scaling：`SVC(probability=True)` 行为与开销
- 概率校准：`CalibratedClassifierCV`（sigmoid/isotonic）、`CalibrationDisplay`、`brier_score_loss`
- 决策边界可视化：`inspection.DecisionBoundaryDisplay.from_estimator`
- SVM 关键超参：RBF 核与 `C`/`gamma` 定义与影响；`gamma='scale'` 默认
- 不平衡与权重：`class_weight='balanced'` 与 `sample_weight`（LR/SVC/LinearSVC 支持）
- 阈值调优：`TunedThresholdClassifierCV` 与 `FixedThresholdClassifier`
- 核近似：`RBFSampler`（Random Kitchen Sinks）

（以上均引自 scikit-learn 官方用户指南/API 参考）

#### 状态与动作
- 审核状态：已完成
- 负责人 / 截止：AI 助理 / 本次迭代
- 变更记录：新增 FP/VC/BP 评分、证据链接与 P0–P2 修订项；补全资源与“术语与引用”。

