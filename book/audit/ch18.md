### ch18 审阅报告（已完成）

#### 概览
- 章节：ch18（构建 AI 团队：多智能体协作与工作流编排）
- 小节清单与定位：
  - ch18/18_1_business_challenge.qmd
  - ch18/18_2_first_principles.qmd
  - ch18/18_3_framework_comparison.qmd
  - ch18/18_4_vibe_coding_practice.qmd
  - ch18/18_5_exercises.qmd
- 总体评估：
  - FP：3/4（“分而治之/角色扮演→群体智能”的动机与推导清晰；可补并发/协调边界与可验证性）
  - VC：4/4（场景抓人、图示充足、CrewAI 实践可玩）
  - BP：3/4（建议补生产级编排：持久化/人类在环/评估与观测/安全与成本治理/框架选型界限）
  - 一句话结论：本章完成“单体→团队”的范式跃迁，补工程治理与评估闭环可达生产级教学质量。

#### 证据与问题（按小节）
- 18_1 商业挑战（`ch18/18_1_business_challenge.qmd`）
  - 认可点：以“AI 创业梦之队”牵引，明确单体智能上限与团队分工价值。
  - 建议：增加可验收指标示例（任务成功率、平均步数、人工接管率、重试后成功率、单次任务成本）。

- 18_2 第一性原理（`ch18/18_2_first_principles.qmd`）
  - 认可点：分而治之/角色+目标+背景（RGB 模式）建立专家心智框架；群体智能涌现阐述到位。
  - 建议（FP/BP）：补“协调 (Coordination) vs 协作 (Cooperation)”与并发冲突、死锁/活锁、任务依赖与拓扑序、幂等与可回滚边界；提出可验证性：可重放轨迹与确定性输出要求。

- 18_3 框架对比（`ch18/18_3_framework_comparison.qmd`）
  - 认可点：AutoGen（对话驱动）、CrewAI（角色驱动）、LangGraph（流程驱动）的哲学区分准确，并有选型指南。
  - 建议（BP）：
    - 在选型表中加入“人类在环/中断/循环/条件分支/检查点/并行/回退/可观测性”维度；指出 LangGraph 在持久化与控制流的优势。
    - 加入 DSPy（声明式自改进）、LlamaIndex/Haystack（数据/索引/RAG）在多智能体流水线中的角色说明。

- 18_4 实践：CrewAI 团队（`ch18/18_4_vibe_coding_practice.qmd`）
  - 认可点：三角色顺序流程贴近真实知识工作流；工具与 .env 提示较完善。
  - 建议（P0/BP）：
    - pip 包名更正：安装 `langchain-deepseek`（pip 用连字符，导入为 `langchain_deepseek`）。
    - 工具安全：为搜索/抓取工具增加参数校验、超时、重试与“敏感操作白名单”；打印来源与时间戳；对外链做最小可信来源限制。
    - 运行治理：固定随机种子（如适用）、设置并发与速率限制、记录 token/成本、保存中间产物以便审计与回放。

- 18_5 练习（`ch18/18_5_exercises.qmd`）
  - 认可点：术语辨析与人类审批架构挑战契合真实团队协作。
  - 建议：要求提交 Mermaid 流程图与评估清单（成功率/步数/人工干预比/错误类型分布/成本），并对“暂停/循环”给出框架选型理由。

#### 修订建议与优先级
- P0（立即修复/防误用）
  - 更正 `18_4` 安装命令中的包名为 `langchain-deepseek`；补充 `.env` 示例并说明多提供商密钥（DeepSeek/OpenAI）与回退策略。
  - 为实践中的外部工具加入参数校验、超时、重试与回退；敏感操作必须启用白名单/确认提示；输出中打印来源与时间戳。

- P1（工程化与可复现）
  - 观测与评估：接入 LangSmith 记录轨迹；采用 AgentEval/OpenEvals 或 AgentBench/WebArena 子集进行离线基准；定义任务成功率/平均步数/成本与SLA。
  - 可恢复性：持久化与检查点（如使用 LangGraph CheckpointSaver/Redis Store）；幂等与重入设计；失败回退路径与人工接管节点。
  - 成本与速率：设置速率限制/重试退避；采集 token/费用并可视化；离线缓存与结果复用。

- P2（术语统一与扩展）
  - 统一术语：角色/目标/背景、协作/协调、状态/节点/边、检查点/回退、人类在环（HITL）。
  - 扩展阅读：对比 AutoGen（对话）、CrewAI（角色）、LangGraph（流程）各自最佳实践与典型失效模式；引入 DSPy 自改进回路的适用边界。

#### 资源与可复现性
- 代码/数据/环境：
  - 建议新增 `book/code/ch18/`：
    - `crewai_news_team.py` 最小可运行示例（三角色顺序流程，含参数校验/超时/白名单/日志与 `.env`）。
    - `requirements.txt`（`crewai`, `crewai[tools]`, `langchain`, `langchain-deepseek`, `langchain-community`, `duckduckgo-search`, `python-dotenv`）。
    - README：环境变量、运行步骤、评估与成本采集说明。
- 资产检查：
  - 未发现 `assets/ch18/` 目录（非必须）；当前小节以文字与代码为主，构建安全。

#### 术语与引用（访问日期 2025-08）
- LangGraph（流程/状态/条件边/检查点/人类在环）：Context7 `{/langchain-ai/langgraph}`
- LangChain（工具/记忆/评估与 LangSmith）：Context7 `{/langchain-ai/langchain}`
- AutoGen（对话驱动多智能体）：Context7 `{/microsoft/autogen}`
- CrewAI（角色驱动团队）：官方文档与仓库（名称引用）
- DSPy（声明式自改进）：Context7 `{/stanfordnlp/dspy}`
- LlamaIndex（数据/索引/RAG 工作流）：Context7 `{/run-llama/llama_index}`
- Haystack（RAG/LLM 应用框架）：Context7 `{/deepset-ai/haystack}`
- 评测基准：AgentBench、WebArena（论文/基准）

#### 状态与动作
- 审核状态：已完成
- 变更记录：新增本章审阅，给出 FP/VC/BP 评分与 P0/P1/P2 修订项；资产检查完成。

