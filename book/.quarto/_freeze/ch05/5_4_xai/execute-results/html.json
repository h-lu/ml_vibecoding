{
  "hash": "368ee2f59d2ae6ec45a3ca8389ccc68d",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"5.4 即时引入 XAI：模型为何如此预测？\"\n---\n\n到目前为止，我们已经构建了一个可以预测房价的回归模型。它或许能给出相当准确的数字，但对于我们的商业伙伴——房地产公司的CEO、销售经理、投资分析师——来说，一个冷冰冰的预测数字是远远不够的，甚至可能是不可信的。\n\n他们会立即追问：\n\n-   “这个模型为什么认为这套房子值300万，而不是350万？”\n-   “在所有因素中，哪些是对房价影响最大的？”\n-   “‘学区房’这个因素，到底能让房价提升多少？”\n\n如果我们的回答是“因为算法就是这么算的”，那么这个模型将永远无法在商业世界中真正落地。一个无法被理解、无法被信任的“黑箱”预测，其商业价值几乎为零。\n\n这就是我们必须在建模后**立即**引入**可解释人工智能 (eXplainable AI, XAI)** 的原因。XAI 的目标是打开模型的“黑箱”，让我们和业务方都能理解模型的决策逻辑。\n\n### 介绍 SHAP：公平地归因预测贡献\n\n在众多 XAI 工具中，**SHAP (SHapley Additive exPlanations)** 是目前最流行、也最基于坚实理论基础的工具之一。\n\n#### 核心思想：源自博弈论的“公平的贡献分配”\n\nSHAP 的核心思想源自合作博弈论中的“沙普利值 (Shapley Value)”。想象一场团队游戏，游戏结束后团队获得了一笔奖金。如何根据每个队员在游戏中的“贡献”来公平地分配这笔奖金？沙普利值的计算方法就是来解决这个问题的。\n\nSHAP 将这个思想巧妙地应用到了机器学习模型的解释上：\n\n-   **游戏** -> **一次模型预测**\n-   **玩家** -> **输入的各个特征** (面积、位置、房龄等)\n-   **奖金** -> **模型的预测结果与平均预测结果（基准值）的差值**\n\n**SHAP 值**因此可以被直观地理解为：**在某一次具体的预测中，某个特征的取值，为这次预测结果贡献了多少“功劳”或“苦劳”**。一个正的 SHAP 值意味着这个特征的取值将最终的预测结果“推高”了；一个负的 SHAP 值则意味着它将预测结果“拉低”了。\n\n### SHAP 的可视化解读\n\nSHAP 最强大的地方在于它提供了一系列直观的可视化工具，让我们能从不同维度“审问”我们的模型。\n\n#### 1. SHAP 力图 (Force Plot)：解剖单次预测\n\n力图是解释**单次预测**最强大的工具。它能清晰地展示，对于某一套房子的具体预测，每一个特征是如何“发力”，将预测价格从所有房子的平均价（基准值），一步步推高或拉低到最终的预测值的。\n\n<iframe src=\"../assets/ch05/shap_force_concept.html\" width=\"100%\" height=\"360\" frameborder=\"0\"></iframe>\n\n**解读**：\n\n-   **基准值 (base value)**：所有样本预测价的平均值，是我们的出发点。\n-   **红色部分**：将预测价格推高的特征。在这个例子中，“面积大”、“是学区房”是主要贡献者。\n-   **蓝色部分**：将预测价格拉低的特征。在这里，“房龄较老”起到了拉低价格的作用。\n-   **最终预测值 (f(x))**：基准值加上所有特征的 SHAP 值之和。\n\n这张图可以让销售经理一目了然地告诉客户：“根据我们的模型，您的房子基础价是280万，但因为它面积很大（+10万）并且是学区房（+5万），所以价格较高。不过由于房龄较老（-5万），所以最终估值是290万。” 这种解释显然比一个干巴巴的数字有说服力得多。\n\n#### 2. SHAP 摘要图 (Summary Plot)：洞察全局规律\n\n摘要图（或叫“蜂群图”）则让我们能从**全局**视角，了解哪些特征对整个模型最重要，以及它们的影响模式。\n\n::: {#cell-fig-shap-summary-plot .cell execution_count=1}\n\n::: {#fig-shap-summary-plot .cell-output .cell-output-display}\n```{=html}\n<div>                            <div id=\"348e3b8b-bd46-41bd-ba53-0c624e53e029\" class=\"plotly-graph-div\" style=\"height:400px; width:100%;\"></div>            <script type=\"text/javascript\">                require([\"plotly\"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"348e3b8b-bd46-41bd-ba53-0c624e53e029\")) {                    Plotly.newPlot(                        \"348e3b8b-bd46-41bd-ba53-0c624e53e029\",                        [{\"marker\":{\"cmax\":1,\"cmin\":0,\"color\":[0.3745401188473625,0.9507143064099162,0.7319939418114051,0.5986584841970366,0.15601864044243652,0.15599452033620265,0.05808361216819946,0.8661761457749352,0.6011150117432088,0.7080725777960455,0.020584494295802447,0.9699098521619943,0.8324426408004217,0.21233911067827616,0.18182496720710062,0.18340450985343382,0.3042422429595377,0.5247564316322378,0.43194501864211576,0.2912291401980419,0.6118528947223795,0.13949386065204183,0.29214464853521815,0.3663618432936917,0.45606998421703593,0.7851759613930136,0.19967378215835974,0.5142344384136116,0.5924145688620425,0.046450412719997725,0.6075448519014384,0.17052412368729153,0.06505159298527952,0.9488855372533332,0.9656320330745594,0.8083973481164611,0.3046137691733707,0.09767211400638387,0.6842330265121569,0.4401524937396013,0.12203823484477883,0.4951769101112702,0.034388521115218396,0.9093204020787821,0.2587799816000169,0.662522284353982,0.31171107608941095,0.5200680211778108,0.5467102793432796,0.18485445552552704],\"colorbar\":{\"title\":{\"text\":\"特征值\\u003cbr\\u003e(高\\u002f低)\"}},\"colorscale\":[[0.0,\"rgb(103,0,31)\"],[0.1,\"rgb(178,24,43)\"],[0.2,\"rgb(214,96,77)\"],[0.3,\"rgb(244,165,130)\"],[0.4,\"rgb(253,219,199)\"],[0.5,\"rgb(247,247,247)\"],[0.6,\"rgb(209,229,240)\"],[0.7,\"rgb(146,197,222)\"],[0.8,\"rgb(67,147,195)\"],[0.9,\"rgb(33,102,172)\"],[1.0,\"rgb(5,48,97)\"]],\"showscale\":true},\"mode\":\"markers\",\"showlegend\":false,\"x\":[6.130752933790268,19.478793522520327,15.226023782825465,10.544466847887996,6.8519218311382435,4.067556248547628,-1.220934751041308,18.636630132766363,10.072936894409533,15.735620763405812,2.728881043930857,17.756832406536464,18.57560507449708,5.07234406743852,5.280619664130993,7.4616761623765715,5.594068627185013,8.987656303929779,6.859871513591268,4.192962234029962,12.082854475619381,3.4721811626741244,6.396274569364401,8.981603363945881,9.147403468096533,18.610587382174906,3.4641619766912823,15.72502710145147,13.099626072770862,-0.7853068584326106,10.009112041906542,4.375427304232201,0.8541062890538885,20.40571173325085,20.259115910638275,16.022289137015477,4.398687947330603,-1.0762521692440519,12.791630626109095,10.515847463438972,2.8689521851559845,7.412060644801428,1.034132274006732,18.957042801033317,3.4078847595980726,13.557895898970695,6.35063895868022,8.11541982789497,11.64978030756216,4.81865816324701],\"y\":[-0.030311196301209486,0.1625417540378944,-0.15552100707753946,-0.002949958283656351,-0.19545854209303237,-0.012535743202349486,-0.17747868972726508,-0.15247283349277124,-0.15298950128915806,0.05968412084642544,0.0984179517061693,0.033347506038863856,0.18486901938981676,-0.050051768190518375,-0.08571516548725572,0.14743965127578412,-0.11056166459221894,0.18528901577624451,-0.19513821012407348,0.18795153068305565,-0.18273603521976955,0.15645724547922846,0.011080443634519932,0.19718591844772015,-0.17048137410584047,0.021541713760528325,0.1877210142476396,0.009239137668059533,0.051759455254105025,0.07829947559384687,-0.018183574092890703,0.051023232033625354,0.0337257247692401,0.1604632041963956,-0.18182144786341686,-0.08761472416310788,0.18016459363062348,0.15610551355636654,-0.01773729888571482,0.048053039120614705,-0.08904752680754693,-0.12475153611049548,-0.014520638024007132,-0.05865910878957889,0.03346244474034882,-0.16890614521400607,0.1897579230664666,0.19448429779184118,0.07926468560789807,0.014438546537648145],\"type\":\"scatter\"},{\"marker\":{\"cmax\":1,\"cmin\":0,\"color\":[0.9695846277645586,0.7751328233611146,0.9394989415641891,0.8948273504276488,0.5978999788110851,0.9218742350231168,0.0884925020519195,0.1959828624191452,0.045227288910538066,0.32533033076326434,0.388677289689482,0.2713490317738959,0.8287375091519293,0.3567533266935893,0.28093450968738076,0.5426960831582485,0.14092422497476265,0.8021969807540397,0.07455064367977082,0.9868869366005173,0.7722447692966574,0.1987156815341724,0.005522117123602399,0.8154614284548342,0.7068573438476171,0.7290071680409873,0.7712703466859457,0.07404465173409036,0.3584657285442726,0.11586905952512971,0.8631034258755935,0.6232981268275579,0.3308980248526492,0.06355835028602363,0.3109823217156622,0.32518332202674705,0.7296061783380641,0.6375574713552131,0.8872127425763265,0.4722149251619493,0.1195942459383017,0.713244787222995,0.7607850486168974,0.5612771975694962,0.770967179954561,0.49379559636439074,0.5227328293819941,0.42754101835854963,0.02541912674409519,0.10789142699330445],\"colorbar\":{\"title\":{\"text\":\"特征值\\u003cbr\\u003e(高\\u002f低)\"}},\"colorscale\":[[0.0,\"rgb(103,0,31)\"],[0.1,\"rgb(178,24,43)\"],[0.2,\"rgb(214,96,77)\"],[0.3,\"rgb(244,165,130)\"],[0.4,\"rgb(253,219,199)\"],[0.5,\"rgb(247,247,247)\"],[0.6,\"rgb(209,229,240)\"],[0.7,\"rgb(146,197,222)\"],[0.8,\"rgb(67,147,195)\"],[0.9,\"rgb(33,102,172)\"],[1.0,\"rgb(5,48,97)\"]],\"showscale\":false},\"mode\":\"markers\",\"showlegend\":false,\"x\":[11.709871902818932,8.734596454486523,6.337145387548655,6.5467601765844865,4.998570216583596,9.85568542717117,-2.6425170966091116,5.64520591759662,-3.179809644955595,2.1510862418101633,2.738162872328635,0.3730179792200343,6.800524147998249,1.8692383413903744,-2.331632783764432,2.66680403389371,-3.856863721036767,7.1967029900832395,0.7475767885435798,6.068773663824264,7.956191920198888,-5.244696519366717,-5.861031974724831,9.409822620757245,5.731420195905183,3.779617964756198,5.13844778176925,-2.530134726119293,-1.0837473352701843,-2.8290469279591046,8.03769506794153,3.046271207201734,4.251358551440389,-2.7787867010736234,-4.385550347580281,0.25065845994006053,4.620519745534184,6.268228739920644,6.723149661779496,1.8537509944954418,-2.19611175296456,7.430182196685167,4.011182915141909,2.7501554918605473,5.614617076996503,1.100275480318437,6.371900921292105,2.223078697300155,-7.140481007508663,-1.5459047009908808],\"y\":[0.923811046514531,1.1255180078827796,1.0738924690215517,0.8650467757379565,1.164370873797537,1.1290148971692675,1.1799199653167696,1.090287803355344,1.045366078374316,0.9672972145162475,1.1730913933416054,1.1464255558001635,0.8180874680424758,0.8105467897989008,0.9505853467512199,1.1242213323127332,1.1949104517259779,0.8601667564414113,1.0376522861408541,0.9523563426524086,1.1879657591258412,1.1368475692542834,1.135331481884455,0.9874772639179881,0.965927800935066,0.9093628287722825,0.8225501986603708,1.1458889505020213,1.125160403652031,1.1998870693144523,1.1986547348295622,1.022172682241051,1.1075949660722042,1.1779062919529713,1.1398589562709647,0.898939240697279,0.9802176541240374,0.851663766060598,1.181620410903489,1.042469853780352,0.8914571222013851,1.0686802737623426,1.0472512961831584,0.9432650872131362,0.8454230368798517,1.0686292782371198,1.0081230803615173,1.1089273566942557,1.0080654004447973,1.140872600127416],\"type\":\"scatter\"},{\"marker\":{\"cmax\":1,\"cmin\":0,\"color\":[0.03142918568673425,0.6364104112637804,0.3143559810763267,0.5085706911647028,0.907566473926093,0.24929222914887494,0.41038292303562973,0.7555511385430487,0.22879816549162246,0.07697990982879299,0.289751452913768,0.16122128725400442,0.9296976523425731,0.808120379564417,0.6334037565104235,0.8714605901877177,0.8036720768991145,0.18657005888603584,0.8925589984899778,0.5393422419156507,0.8074401551640625,0.8960912999234932,0.3180034749718639,0.11005192452767676,0.22793516254194168,0.4271077886262563,0.8180147659224931,0.8607305832563434,0.006952130531190703,0.5107473025775657,0.417411003148779,0.22210781047073025,0.1198653673336828,0.33761517140362796,0.9429097039125192,0.32320293202075523,0.5187906217433661,0.7030189588951778,0.363629602379294,0.9717820827209607,0.9624472949421112,0.25178229582536416,0.49724850589238545,0.30087830981676966,0.2848404943774676,0.036886947354532795,0.6095643339798968,0.5026790232288615,0.05147875124998935,0.27864646423661144],\"colorbar\":{\"title\":{\"text\":\"特征值\\u003cbr\\u003e(高\\u002f低)\"}},\"colorscale\":[[0.0,\"rgb(103,0,31)\"],[0.1,\"rgb(178,24,43)\"],[0.2,\"rgb(214,96,77)\"],[0.3,\"rgb(244,165,130)\"],[0.4,\"rgb(253,219,199)\"],[0.5,\"rgb(247,247,247)\"],[0.6,\"rgb(209,229,240)\"],[0.7,\"rgb(146,197,222)\"],[0.8,\"rgb(67,147,195)\"],[0.9,\"rgb(33,102,172)\"],[1.0,\"rgb(5,48,97)\"]],\"showscale\":false},\"mode\":\"markers\",\"showlegend\":false,\"x\":[3.930020537157924,-4.29917359153551,-6.182299742671294,-6.054175057379531,-6.5418424408876845,-3.908261222726311,-3.21619037406384,-6.006243278571813,-4.14184259807239,-0.8888498104115301,-9.380049209275825,-3.660988155208624,-9.802112826212051,-10.576770159573869,-3.0692149572409644,-11.574888657798443,-8.916809742385112,-1.6042194342881757,-6.043043406767547,-8.265146721515386,-5.7480740473307055,-8.940446877195757,-5.143052051814541,-0.17631229675022608,-1.8812322342724768,-5.471511640580152,-8.040543489244893,-9.377933026286954,0.15751338519058905,-3.7832116767335644,-1.0020763991970858,-4.696709102361001,3.067413075975705,-7.280327313081283,-9.732667229196359,-2.0553949072383992,-4.625922481963596,-8.275588628592965,-4.05254052450749,-10.703822696527272,-10.803202463309535,-0.8186187642115923,-4.25845408699376,-4.394602288689005,-1.0492051929081747,0.24572956820789071,-4.4699191021210485,-3.7675325484413906,-2.1727775343440383,-3.9068267227600537],\"y\":[2.0207627355097944,2.0243751886141546,2.1506614410633382,1.9613931464849588,1.8536060913802563,1.8115130705253355,2.1020549022694475,2.048123820541386,2.0816319072396894,1.8851856646035643,1.8545485902347079,1.8058178662671527,1.9402350235226389,2.035967074741853,1.956897618039893,1.9749899688094916,2.1616634777974992,1.93930218680932,2.0055957956639245,2.113461205096457,1.9586171129285082,2.0488346800911494,2.144945483498698,2.179808249463057,1.8588293923716153,2.1706350500645977,1.9968465172318153,1.9032977553195833,1.9836543024953046,2.192013030114191,1.9970472375971478,1.9315006441150033,2.05336034172669,1.8960582475112773,1.8303453312434654,1.8515518887642597,1.8512183355831089,1.8607610774049177,1.855530869059764,2.0563498979212858,1.872752033759658,1.9382669133295454,2.1587153639624046,1.989584656105149,2.067023095408411,1.868927948480652,1.8769156075234683,1.8163474465065916,1.8675740252288657,1.9114361356127834],\"type\":\"scatter\"},{\"marker\":{\"cmax\":1,\"cmin\":0,\"color\":[0.9082658859666537,0.23956189066697242,0.1448948720912231,0.489452760277563,0.9856504541106007,0.2420552715115004,0.6721355474058786,0.7616196153287176,0.23763754399239967,0.7282163486118596,0.3677831327192532,0.6323058305935795,0.6335297107608947,0.5357746840747585,0.0902897700544083,0.835302495589238,0.32078006497173583,0.18651851039985423,0.040775141554763916,0.5908929431882418,0.6775643618422824,0.016587828927856152,0.512093058299281,0.22649577519793795,0.6451727904094499,0.17436642900499144,0.690937738102466,0.3867353463005374,0.9367299887367345,0.13752094414599325,0.3410663510502585,0.11347352124058907,0.9246936182785628,0.877339353380981,0.2579416277151556,0.659984046034179,0.8172222002012158,0.5552008115994623,0.5296505783560065,0.24185229090045168,0.09310276780589921,0.8972157579533268,0.9004180571633305,0.6331014572732679,0.3390297910487007,0.3492095746126609,0.7259556788702394,0.8971102599525771,0.8870864242651173,0.7798755458576239],\"colorbar\":{\"title\":{\"text\":\"特征值\\u003cbr\\u003e(高\\u002f低)\"}},\"colorscale\":[[0.0,\"rgb(103,0,31)\"],[0.1,\"rgb(178,24,43)\"],[0.2,\"rgb(214,96,77)\"],[0.3,\"rgb(244,165,130)\"],[0.4,\"rgb(253,219,199)\"],[0.5,\"rgb(247,247,247)\"],[0.6,\"rgb(209,229,240)\"],[0.7,\"rgb(146,197,222)\"],[0.8,\"rgb(67,147,195)\"],[0.9,\"rgb(33,102,172)\"],[1.0,\"rgb(5,48,97)\"]],\"showscale\":false},\"mode\":\"markers\",\"showlegend\":false,\"x\":[2.7886230349565304,-0.6918202812316732,-1.7964272335080327,0.06459118469659707,3.7059171663414285,-1.8812950312783276,1.4077751181994307,1.105905424209694,-1.529493483265222,2.239858595046488,0.16433201258429597,1.475038788968536,1.9731273609588027,0.19987726200655143,-1.3665981784329948,1.366245721352734,-0.5719333226528787,-1.6975505023684132,-2.199128327233462,1.0496217413781226,0.06960112597793955,-0.3246735796752591,-0.9455520900032971,-2.581709736798042,1.883974825547317,-0.8365051610121068,1.5788085075644849,0.06202224076696694,2.171403170836758,-2.7096496507558654,-0.7188636865549811,-2.6097941053091662,3.0985878248105654,1.7396393854027665,-2.0357890582167335,0.47853438851790175,1.9990424552817034,-0.28772049480666306,-0.673967503786399,-1.0470513340058294,-1.789519589861781,1.4791356143955041,1.5310519801983293,0.897557223723976,-2.252935386253821,-2.1614159013132506,0.41133417309876097,1.7721041480510382,2.246339686923591,2.8747339462376713],\"y\":[2.8708041937106987,2.835481013502822,2.8482543484402405,2.98431150721309,2.882533487362317,2.94570794441923,3.001366908341943,3.076157931451746,2.8157248559364394,3.119764159563617,3.0511601557963632,2.832703612779549,3.149431449642711,3.1683489602127253,2.8244311839419454,2.9107510592588817,3.1224805119172245,3.0993038761534635,2.8738084077425508,2.883739729334684,2.948188841116553,2.9938091940764084,3.0473019086121185,2.9475654558279087,2.985013886453259,3.098988375253503,2.814673281156239,2.9009747777376083,3.085339834353821,3.15808273507488,3.0046709768462665,3.0128453941061264,2.8428688045359105,2.978964946729382,3.013046906582009,2.8969882014538917,2.907697292379752,2.950913665241849,2.8080284791110905,2.9288316662332714,2.884579202798618,2.9309989408711656,2.8479048527277007,3.156210912295958,3.0374369814216196,3.071640927657796,3.1156684954429354,2.999376879571623,2.8347681152349695,3.014842616727419],\"type\":\"scatter\"}],                        {\"template\":{\"data\":{\"histogram2dcontour\":[{\"type\":\"histogram2dcontour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"choropleth\":[{\"type\":\"choropleth\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"histogram2d\":[{\"type\":\"histogram2d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"heatmap\":[{\"type\":\"heatmap\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"heatmapgl\":[{\"type\":\"heatmapgl\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"contourcarpet\":[{\"type\":\"contourcarpet\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"contour\":[{\"type\":\"contour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"surface\":[{\"type\":\"surface\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"mesh3d\":[{\"type\":\"mesh3d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"scatter\":[{\"fillpattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2},\"type\":\"scatter\"}],\"parcoords\":[{\"type\":\"parcoords\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolargl\":[{\"type\":\"scatterpolargl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"bar\":[{\"error_x\":{\"color\":\"#2a3f5f\"},\"error_y\":{\"color\":\"#2a3f5f\"},\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"scattergeo\":[{\"type\":\"scattergeo\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolar\":[{\"type\":\"scatterpolar\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"scattergl\":[{\"type\":\"scattergl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatter3d\":[{\"type\":\"scatter3d\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattermapbox\":[{\"type\":\"scattermapbox\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterternary\":[{\"type\":\"scatterternary\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattercarpet\":[{\"type\":\"scattercarpet\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"baxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"type\":\"carpet\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#EBF0F8\"},\"line\":{\"color\":\"white\"}},\"header\":{\"fill\":{\"color\":\"#C8D4E3\"},\"line\":{\"color\":\"white\"}},\"type\":\"table\"}],\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}]},\"layout\":{\"autotypenumbers\":\"strict\",\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#2a3f5f\"},\"hovermode\":\"closest\",\"hoverlabel\":{\"align\":\"left\"},\"paper_bgcolor\":\"white\",\"plot_bgcolor\":\"#E5ECF6\",\"polar\":{\"bgcolor\":\"#E5ECF6\",\"angularaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"radialaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"ternary\":{\"bgcolor\":\"#E5ECF6\",\"aaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"caxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]]},\"xaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"yaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"yaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"zaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2}},\"shapedefaults\":{\"line\":{\"color\":\"#2a3f5f\"}},\"annotationdefaults\":{\"arrowcolor\":\"#2a3f5f\",\"arrowhead\":0,\"arrowwidth\":1},\"geo\":{\"bgcolor\":\"white\",\"landcolor\":\"#E5ECF6\",\"subunitcolor\":\"white\",\"showland\":true,\"showlakes\":true,\"lakecolor\":\"white\"},\"title\":{\"x\":0.05},\"mapbox\":{\"style\":\"light\"},\"margin\":{\"b\":0,\"l\":0,\"r\":0,\"t\":30}}},\"shapes\":[{\"line\":{\"color\":\"black\",\"width\":1},\"type\":\"line\",\"x0\":0,\"x1\":0,\"y0\":-0.5,\"y1\":3.5}],\"yaxis\":{\"title\":{\"text\":\"特征 (按重要性排序)\"},\"tickmode\":\"array\",\"tickvals\":[0,1,2,3],\"ticktext\":[\"\\u003cb\\u003e位置便利度\\u003c\\u002fb\\u003e\",\"\\u003cb\\u003e面积\\u003c\\u002fb\\u003e\",\"\\u003cb\\u003e房龄\\u003c\\u002fb\\u003e\",\"\\u003cb\\u003e卧室数量\\u003c\\u002fb\\u003e\"]},\"title\":{\"text\":\"\\u003cb\\u003eSHAP 摘要图 (Summary Plot) 概念示意\\u003c\\u002fb\\u003e\"},\"xaxis\":{\"title\":{\"text\":\"对预测价格的影响 (SHAP 值)\"}},\"height\":400},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('348e3b8b-bd46-41bd-ba53-0c624e53e029');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };                });            </script>        </div>\n```\n\n一个 SHAP 摘要图的示例\n:::\n:::\n\n\n**解读**:\n\n1.  **特征重要性**: 纵轴上的特征是按其 SHAP 值绝对值的平均大小来排序的。排在最上面的“位置便利度”是全局最重要的特征。\n2.  **影响方向**: 横轴是 SHAP 值。落在零点右边的点表示该特征的取值对本次预测有正向贡献（推高价格），左边则为负向贡献。\n3.  **特征取值与影响的关系**: 点的颜色代表了该特征本身的取值大小（红色为高，蓝色为低）。\n    -   对于“位置便利度”，我们可以清晰地看到，红色的点（便利度高）几乎都在右侧，蓝色的点（便利度低）都在左侧。这符合我们的直觉：位置越好，对房价的正面影响越大。\n    -   对于“房龄”，模式则相反。红色的点（房龄大）都在左侧（负贡献），蓝色的点（房龄小）都在右侧（正贡献）。\n\n摘要图能让我们快速地向业务方汇报全局性的发现：“根据我们的模型，影响房价最重要的三个因素是位置、面积和房龄。其中位置和面积是正向影响，房龄是负向影响。卧室数量的影响则相对较小。”\n\n通过 SHAP，我们把一个“黑箱”模型，变成了一个可以被审视、被理解、被信任的“白箱”决策辅助工具，这是机器学习项目在真实世界中取得成功的关键一步。\n\n",
    "supporting": [
      "5_4_xai_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script type=\"text/javascript\">\nwindow.PlotlyConfig = {MathJaxConfig: 'local'};\nif (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}\nif (typeof require !== 'undefined') {\nrequire.undef(\"plotly\");\nrequirejs.config({\n    paths: {\n        'plotly': ['https://cdn.plot.ly/plotly-2.27.0.min']\n    }\n});\nrequire(['plotly'], function(Plotly) {\n    window._Plotly = Plotly;\n});\n}\n</script>\n\n"
      ]
    }
  }
}